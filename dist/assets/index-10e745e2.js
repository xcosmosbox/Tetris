(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var ve=function(e,t){return ve=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},ve(e,t)};function N(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");ve(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function ct(e,t,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(h){try{u(n.next(h))}catch(y){s(y)}}function l(h){try{u(n.throw(h))}catch(y){s(y)}}function u(h){h.done?i(h.value):o(h.value).then(a,l)}u((n=n.apply(e,t||[])).next())})}function We(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(h){return l([u,h])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(r=0)),r;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(h){u=[6,h],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function K(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function G(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],s;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function L(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function B(e){return this instanceof B?(this.v=e,this):new B(e)}function lt(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(d){n[d]&&(o[d]=function(O){return new Promise(function(w,I){i.push([d,O,w,I])>1||a(d,O)})})}function a(d,O){try{l(n[d](O))}catch(w){y(i[0][3],w)}}function l(d){d.value instanceof B?Promise.resolve(d.value.v).then(u,h):y(i[0][2],d)}function u(d){a("next",d)}function h(d){a("throw",d)}function y(d,O){d(O),i.shift(),i.length&&a(i[0][0],i[0][1])}}function ft(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof K=="function"?K(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(s){return new Promise(function(a,l){s=e[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(u){i({value:u,done:a})},s)}}function b(e){return typeof e=="function"}function ht(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var de=ht(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function ye(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var oe=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=K(s),l=a.next();!l.done;l=a.next()){var u=l.value;u.remove(this)}}catch(I){t={error:I}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else s.remove(this);var h=this.initialTeardown;if(b(h))try{h()}catch(I){i=I instanceof de?I.errors:[I]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var d=K(y),O=d.next();!O.done;O=d.next()){var w=O.value;try{Te(w)}catch(I){i=i??[],I instanceof de?i=L(L([],G(i)),G(I.errors)):i.push(I)}}}catch(I){n={error:I}}finally{try{O&&!O.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}}if(i)throw new de(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Te(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&ye(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&ye(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();oe.EMPTY;function Me(e){return e instanceof oe||e&&"closed"in e&&b(e.remove)&&b(e.add)&&b(e.unsubscribe)}function Te(e){b(e)?e():e.unsubscribe()}var Be={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ie={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=Ie.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,L([e,t],G(r))):setTimeout.apply(void 0,L([e,t],G(r)))},clearTimeout:function(e){var t=Ie.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ke(e){Ie.setTimeout(function(){throw e})}function Se(){}function dt(e){e()}var Oe=function(e){N(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Me(r)&&r.add(n)):n.destination=yt,n}return t.create=function(r,n,o){return new me(r,n,o)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(oe),pt=Function.prototype.bind;function pe(e,t){return pt.call(e,t)}var bt=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){te(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){te(n)}else te(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){te(r)}},e}(),me=function(e){N(t,e);function t(r,n,o){var i=e.call(this)||this,s;if(b(r)||!r)s={next:r??void 0,error:n??void 0,complete:o??void 0};else{var a;i&&Be.useDeprecatedNextContext?(a=Object.create(r),a.unsubscribe=function(){return i.unsubscribe()},s={next:r.next&&pe(r.next,a),error:r.error&&pe(r.error,a),complete:r.complete&&pe(r.complete,a)}):s=r}return i.destination=new bt(s),i}return t}(Oe);function te(e){ke(e)}function vt(e){throw e}var yt={closed:!0,next:Se,error:vt,complete:Se},De=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ne(e){return e}function It(e){return e.length===0?Ne:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var j=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,i=gt(t)?t:new me(t,r,n);return dt(function(){var s=o,a=s.operator,l=s.source;i.add(a?a.call(i,l):l?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=xe(r),new r(function(o,i){var s=new me({next:function(a){try{t(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[De]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return It(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=xe(t),new t(function(n,o){var i;r.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function xe(e){var t;return(t=e??Be.Promise)!==null&&t!==void 0?t:Promise}function mt(e){return e&&b(e.next)&&b(e.error)&&b(e.complete)}function gt(e){return e&&e instanceof Oe||mt(e)&&Me(e)}function Ot(e){return b(e==null?void 0:e.lift)}function V(e){return function(t){if(Ot(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function k(e,t,r,n,o){return new Dt(e,t,r,n,o)}var Dt=function(e){N(t,e);function t(r,n,o,i,s,a){var l=e.call(this,r)||this;return l.onFinalize=s,l.shouldUnsubscribe=a,l._next=n?function(u){try{n(u)}catch(h){r.error(h)}}:e.prototype._next,l._error=i?function(u){try{i(u)}catch(h){r.error(h)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=o?function(){try{o()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,l}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(Oe),Ve={now:function(){return(Ve.delegate||Date).now()},delegate:void 0},Ht=function(e){N(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(oe),ne={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=ne.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,L([e,t],G(r))):setInterval.apply(void 0,L([e,t],G(r)))},clearInterval:function(e){var t=ne.delegate;return((t==null?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},jt=function(e){N(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.scheduler=r,o.work=n,o.pending=!1,o}return t.prototype.schedule=function(r,n){var o;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,n)),this.pending=!0,this.delay=n,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(s,this.id,n),this},t.prototype.requestAsyncId=function(r,n,o){return o===void 0&&(o=0),ne.setInterval(r.flush.bind(r,this),o)},t.prototype.recycleAsyncId=function(r,n,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return n;n!=null&&ne.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(r,n);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var o=!1,i;try{this.work(r)}catch(s){o=!0,i=s||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,o=r.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ye(i,this),n!=null&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Ht),Ce=function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=Ve.now,e}(),wt=function(e){N(t,e);function t(r,n){n===void 0&&(n=Ce.now);var o=e.call(this,r,n)||this;return o.actions=[],o._active=!1,o}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var o;this._active=!0;do if(o=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,o){for(;r=n.shift();)r.unsubscribe();throw o}},t}(Ce),$e=new wt(jt),Tt=$e,St=new j(function(e){return e.complete()});function Ke(e){return e&&b(e.schedule)}function Ue(e){return e[e.length-1]}function xt(e){return Ke(Ue(e))?e.pop():void 0}function Ct(e,t){return typeof Ue(e)=="number"?e.pop():t}var He=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function qe(e){return b(e==null?void 0:e.then)}function Fe(e){return b(e[De])}function Ye(e){return Symbol.asyncIterator&&b(e==null?void 0:e[Symbol.asyncIterator])}function Qe(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function At(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Je=At();function Xe(e){return b(e==null?void 0:e[Je])}function Ze(e){return lt(this,arguments,function(){var r,n,o,i;return We(this,function(s){switch(s.label){case 0:r=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,B(r.read())];case 3:return n=s.sent(),o=n.value,i=n.done,i?[4,B(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,B(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function ze(e){return b(e==null?void 0:e.getReader)}function W(e){if(e instanceof j)return e;if(e!=null){if(Fe(e))return Et(e);if(He(e))return Gt(e);if(qe(e))return Pt(e);if(Ye(e))return et(e);if(Xe(e))return _t(e);if(ze(e))return Rt(e)}throw Qe(e)}function Et(e){return new j(function(t){var r=e[De]();if(b(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Gt(e){return new j(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function Pt(e){return new j(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,ke)})}function _t(e){return new j(function(t){var r,n;try{for(var o=K(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function et(e){return new j(function(t){Lt(e,t).catch(function(r){return t.error(r)})})}function Rt(e){return et(Ze(e))}function Lt(e,t){var r,n,o,i;return ct(this,void 0,void 0,function(){var s,a;return We(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=ft(e),l.label=1;case 1:return[4,r.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),o={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function E(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function tt(e,t){return t===void 0&&(t=0),V(function(r,n){r.subscribe(k(n,function(o){return E(n,e,function(){return n.next(o)},t)},function(){return E(n,e,function(){return n.complete()},t)},function(o){return E(n,e,function(){return n.error(o)},t)}))})}function rt(e,t){return t===void 0&&(t=0),V(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function Wt(e,t){return W(e).pipe(rt(t),tt(t))}function Mt(e,t){return W(e).pipe(rt(t),tt(t))}function Bt(e,t){return new j(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function kt(e,t){return new j(function(r){var n;return E(r,t,function(){n=e[Je](),E(r,t,function(){var o,i,s;try{o=n.next(),i=o.value,s=o.done}catch(a){r.error(a);return}s?r.complete():r.next(i)},0,!0)}),function(){return b(n==null?void 0:n.return)&&n.return()}})}function nt(e,t){if(!e)throw new Error("Iterable cannot be null");return new j(function(r){E(r,t,function(){var n=e[Symbol.asyncIterator]();E(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function Nt(e,t){return nt(Ze(e),t)}function Vt(e,t){if(e!=null){if(Fe(e))return Wt(e,t);if(He(e))return Bt(e,t);if(qe(e))return Mt(e,t);if(Ye(e))return nt(e,t);if(Xe(e))return kt(e,t);if(ze(e))return Nt(e,t)}throw Qe(e)}function $t(e,t){return t?Vt(e,t):W(e)}function Kt(e){return e instanceof Date&&!isNaN(e)}function A(e,t){return V(function(r,n){var o=0;r.subscribe(k(n,function(i){n.next(e.call(t,i,o++))}))})}var Ut=Array.isArray;function qt(e,t){return Ut(t)?e.apply(void 0,L([],G(t))):e(t)}function Ft(e){return A(function(t){return qt(e,t)})}function Yt(e,t,r,n,o,i,s,a){var l=[],u=0,h=0,y=!1,d=function(){y&&!l.length&&!u&&t.complete()},O=function(I){return u<n?w(I):l.push(I)},w=function(I){i&&t.next(I),u++;var Z=!1;W(r(I,h++)).subscribe(k(t,function(P){o==null||o(P),i?O(P):t.next(P)},function(){Z=!0},void 0,function(){if(Z)try{u--;for(var P=function(){var M=l.shift();s?E(t,s,function(){return w(M)}):w(M)};l.length&&u<n;)P();d()}catch(M){t.error(M)}}))};return e.subscribe(k(t,O,function(){y=!0,d()})),function(){a==null||a()}}function je(e,t,r){return r===void 0&&(r=1/0),b(t)?je(function(n,o){return A(function(i,s){return t(n,i,o,s)})(W(e(n,o)))},r):(typeof t=="number"&&(r=t),V(function(n,o){return Yt(n,o,e,r)}))}function Qt(e){return e===void 0&&(e=1/0),je(Ne,e)}var Jt=["addListener","removeListener"],Xt=["addEventListener","removeEventListener"],Zt=["on","off"];function $(e,t,r,n){if(b(r)&&(n=r,r=void 0),n)return $(e,t,r).pipe(Ft(n));var o=G(tr(e)?Xt.map(function(a){return function(l){return e[a](t,l,r)}}):zt(e)?Jt.map(Ae(e,t)):er(e)?Zt.map(Ae(e,t)):[],2),i=o[0],s=o[1];if(!i&&He(e))return je(function(a){return $(a,t,r)})(W(e));if(!i)throw new TypeError("Invalid event target");return new j(function(a){var l=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return a.next(1<u.length?u:u[0])};return i(l),function(){return s(l)}})}function Ae(e,t){return function(r){return function(n){return e[r](t,n)}}}function zt(e){return b(e.addListener)&&b(e.removeListener)}function er(e){return b(e.on)&&b(e.off)}function tr(e){return b(e.addEventListener)&&b(e.removeEventListener)}function rr(e,t,r){e===void 0&&(e=0),r===void 0&&(r=Tt);var n=-1;return t!=null&&(Ke(t)?r=t:n=t),new j(function(o){var i=Kt(e)?+e-r.now():e;i<0&&(i=0);var s=0;return r.schedule(function(){o.closed||(o.next(s++),0<=n?this.schedule(void 0,n):o.complete())},i)})}function be(e,t){return e===void 0&&(e=0),t===void 0&&(t=$e),e<0&&(e=0),rr(e,e,t)}function nr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=xt(e),n=Ct(e,1/0),o=e;return o.length?o.length===1?W(o[0]):Qt(n)($t(o,r)):St}function or(e,t){return V(function(r,n){var o=0;r.subscribe(k(n,function(i){return e.call(t,i,o++)&&n.next(i)}))})}function ir(e,t,r,n,o){return function(i,s){var a=r,l=t,u=0;i.subscribe(k(s,function(h){var y=u++;l=a?e(l,h,y):(a=!0,h),n&&s.next(l)},o&&function(){a&&s.next(l),s.complete()}))}}function ot(e,t){return V(ir(e,t,arguments.length>=2,!0))}class g{}Object.defineProperty(g,"m",{enumerable:!0,configurable:!0,writable:!0,value:2147483648});Object.defineProperty(g,"a",{enumerable:!0,configurable:!0,writable:!0,value:1103515245});Object.defineProperty(g,"c",{enumerable:!0,configurable:!0,writable:!0,value:12345});Object.defineProperty(g,"hash",{enumerable:!0,configurable:!0,writable:!0,value:e=>(g.a*e+g.c)%g.m});Object.defineProperty(g,"scale",{enumerable:!0,configurable:!0,writable:!0,value:e=>Math.floor(e/g.m*4+1)-1});function Ee(e){return function(r=0){return e.pipe(ot(o=>g.hash(o),r),A(g.scale))}}const re=(e,t)=>{const r=[cr,lr,fr,hr];return new r[e](t)},ie=e=>["red","green","blue","yellow"][e],Ge=(e,t,r)=>{var n;return g.scale(g.hash(t)+g.hash(r))<1?g.scale(g.hash(g.scale(g.hash(t)+g.hash(r))))<2&&((n=e.scoreAndDropRate)===null||n===void 0?void 0:n.gameLevel)>3?{currentBlock:re(t,r),nextBlock:new pr}:{currentBlock:re(t,r),nextBlock:new dr}:{currentBlock:re(t,r),nextBlock:re(t,r)}},sr=e=>Array.from({length:C.GRID_WIDTH}).map((t,r)=>({color:"gray",shape:S.BEDROCK,position:{x:r*c.WIDTH,y:m.CANVAS_HEIGHT-(C.GRID_HEIGHT-e)*c.HEIGHT},rotationID:0})),ge=(e,t=!1,r=0)=>{var n,o,i,s;const a=t?((n=e.scoreAndDropRate)===null||n===void 0?void 0:n.gameScore)+100*r:((o=e.scoreAndDropRate)===null||o===void 0?void 0:o.gameScore)+10,l=Math.floor(a/1e3)+1,u=a>((i=e.scoreAndDropRate)===null||i===void 0?void 0:i.gameHighScore)?a:(s=e.scoreAndDropRate)===null||s===void 0?void 0:s.gameHighScore;if(l>1&&l<=10){const h=e.oldGameCubes.map((y,d)=>d>=C.GRID_HEIGHT-(l-1)?sr(d):y);return Object.assign(Object.assign({},e),{scoreAndDropRate:Object.assign(Object.assign({},e.scoreAndDropRate),{gameScore:a,gameHighScore:u,gameLevel:l}),oldGameCubes:h})}return Object.assign(Object.assign({},e),{scoreAndDropRate:Object.assign(Object.assign({},e.scoreAndDropRate),{gameScore:a,gameHighScore:u,gameLevel:l})})},ar=e=>e.some(t=>t.every(r=>r!==null&&r.shape!==S.BEDROCK)),ur=e=>{const t=e.oldGameCubes.map((a,l)=>a.every(u=>u!==null&&u.shape!==S.BEDROCK)?l:-1).filter(a=>a!==-1),r=e.oldGameCubes.map((a,l)=>t.includes(l)&&a.some(u=>u!==null&&u.shape===S.STAR)?l:-1).filter(a=>a!==-1),n=[...new Set(r.reduce((a,l)=>l===0?[0,1,...a]:l===19?[18,19,...a]:[l-1,l,l+1,...a],[]))],o=[...new Set([...t,...n])],i=e.oldGameCubes.map((a,l)=>o.includes(l)?new Array(a.length).fill(null):a),s=i.map((a,l)=>l<=Math.max(...o)?l-o.length>=0?i[l-o.length].map(u=>u?Object.assign(Object.assign({},u),{position:Object.assign(Object.assign({},u.position),{y:u.position.y+o.length*c.HEIGHT})}):null):new Array(a.length).fill(null):a);return ge(Object.assign(Object.assign({},e),{oldGameCubes:s}),!0,o.length)},it=(e,t,r,n)=>e.map((o,i)=>i===t?o.map((s,a)=>a===r?n:s):o),T=(e,t,r)=>t==="x"&&r<0?e.every(n=>n.position.x+r>=0):t==="x"&&r>0?e.every(n=>n.position.x+r<=m.CANVAS_WIDTH-c.WIDTH):e.every(n=>n.position.y+r<=m.CANVAS_HEIGHT-c.HEIGHT),v=(e,t,r)=>r==="l"?!!e.oldGameCubes[Math.floor(t.position.y/c.HEIGHT)][Math.floor(t.position.x/c.WIDTH)-1]:r==="r"?!!e.oldGameCubes[Math.floor(t.position.y/c.HEIGHT)][Math.floor(t.position.x/c.WIDTH)+1]:!!e.oldGameCubes[Math.floor(t.position.y/c.HEIGHT)+1][Math.floor(t.position.x/c.WIDTH)],U=(e,t)=>{const r=e.cubes.map(n=>Object.assign(Object.assign({},n),{position:{x:Math.floor(n.position.x/c.WIDTH)*c.WIDTH,y:n.position.y}}));return e.cubes=r,Object.assign(Object.assign({},t),{currentGameCube:e})},q=(e,t,r)=>{const n=e.cubes.map(o=>Object.assign(Object.assign({},o),{position:{x:o.position.x+r,y:o.position.y}}));return e.cubes=n,Object.assign(Object.assign({},t),{currentGameCube:e})},F=(e,t)=>{const r=e.cubes.map(n=>Object.assign(Object.assign({},n),{position:{x:Math.floor(n.position.x/c.WIDTH)*c.WIDTH,y:n.position.y}}));return e.cubes=r,Object.assign(Object.assign({},t),{currentGameCube:e})},Y=(e,t,r)=>{const n=e.cubes.map(o=>Object.assign(Object.assign({},o),{position:{x:o.position.x+r,y:o.position.y}}));return e.cubes=n,Object.assign(Object.assign({},t),{currentGameCube:e})},Q=(e,t)=>{const r=e.cubes.map(n=>Object.assign(Object.assign({},n),{position:{x:n.position.x,y:Math.floor(n.position.y/c.HEIGHT)*c.HEIGHT}}));return e.cubes=r,Object.assign(Object.assign({},t),{currentGameCube:e})},J=(e,t,r)=>{const n=e.cubes.map(o=>Object.assign(Object.assign({},o),{position:{x:o.position.x,y:o.position.y+r}}));return e.cubes=n,Object.assign(Object.assign({},t),{currentGameCube:e})};class X{constructor(){Object.defineProperty(this,"cubes",{enumerable:!0,configurable:!0,writable:!0,value:new Array(C.CUBE_NUMBERS).fill(null)}),Object.defineProperty(this,"rotationLevel",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"moveHelper",{enumerable:!0,configurable:!0,writable:!0,value:(t,r,n,o,i,s,a,l)=>T(t.cubes,o,n)?t.cubes.some(u=>s(r,u,i))?a(t,r):l(t,r,n):r}),Object.defineProperty(this,"checkContinueMove",{enumerable:!0,configurable:!0,writable:!0,value:t=>T(this.cubes,"y",c.HEIGHT)?!this.checkContinueDown(t,this.cubes):!1}),Object.defineProperty(this,"updatePositions",{enumerable:!0,configurable:!0,writable:!0,value:t=>this.moveDown(t,c.HEIGHT)}),Object.defineProperty(this,"updateOldGameCubes",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const r=this.updateOldGameCubesRec(0,t.oldGameCubes);return Object.assign(Object.assign({},t),{oldGameCubes:r})}}),Object.defineProperty(this,"updateOldGameCubesRec",{enumerable:!0,configurable:!0,writable:!0,value:(t,r)=>{if(t>=this.cubes.length)return r;const n=this.cubes.find(o=>o.rotationID===t);if(n){const o=it(r,Math.floor(n.position.y/c.HEIGHT),Math.floor(n.position.x/c.WIDTH),n);return this.updateOldGameCubesRec(t+1,o)}return this.updateOldGameCubesRec(t+1,r)}})}}class cr extends X{constructor(t){super(),Object.defineProperty(this,"moveLeft",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>T(this.cubes,"x",o)?this.cubes.some(i=>(i.rotationID===0||i.rotationID===2)&&v(n,i,"l"))?U(this,n):q(this,n,o):n}),Object.defineProperty(this,"moveRight",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>T(this.cubes,"x",o)?this.cubes.some(i=>(i.rotationID===1||i.rotationID===3)&&v(n,i,"r"))?F(this,n):Y(this,n,o):n}),Object.defineProperty(this,"moveDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>T(this.cubes,"y",o)?this.checkContinueDown(n,this.cubes)?Q(this,n):J(this,n,o):n}),Object.defineProperty(this,"rotate",{enumerable:!0,configurable:!0,writable:!0,value:n=>n}),Object.defineProperty(this,"checkContinueDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>o.some(i=>(i.rotationID===2||i.rotationID===3)&&v(n,i,"d"))});const r={color:ie(t),shape:S.SQUARE_BLOCK,position:D.POSITION_1,rotationID:0};this.cubes=[r,Object.assign(Object.assign({},r),{position:D.POSITION_2,rotationID:1}),Object.assign(Object.assign({},r),{position:D.POSITION_5,rotationID:2}),Object.assign(Object.assign({},r),{position:D.POSITION_6,rotationID:3})]}}class lr extends X{constructor(t){super(),Object.defineProperty(this,"rotationLevel",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"moveRight",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>{const i=s=>function(l,u,h){return(s===0&&(u.rotationID===3||u.rotationID===0)||s===2&&(u.rotationID===1||u.rotationID===0)||s===3&&(u.rotationID===0||u.rotationID===1||u.rotationID===3)||s===1&&(u.rotationID===1||u.rotationID===2||u.rotationID===3))&&v(l,u,h)};return this.moveHelper(this,n,o,"x","r",i(this.rotationLevel),F,Y)}}),Object.defineProperty(this,"moveDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>T(this.cubes,"y",o)?this.checkContinueDown(n,this.cubes)?Q(this,n):J(this,n,o):n}),Object.defineProperty(this,"rotate",{enumerable:!0,configurable:!0,writable:!0,value:n=>{const o=this.cubes.reduce((i,s)=>Object.assign(Object.assign({},i),{[s.rotationID]:s.position}),{});if(this.rotationLevel===0){const i=this.cubes.find(s=>s.rotationID===2);if(i&&!v(n,i,"d")){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:o[1]}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{y:o[2].y+c.HEIGHT})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[0]}));this.cubes=s,this.rotationLevel=1}else return n}else if(this.rotationLevel===1){const i=this.cubes.find(s=>s.rotationID===2);if(i&&i.position.x!==m.CANVAS_WIDTH-c.WIDTH&&!v(n,i,"r")){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:o[1]}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{x:o[2].x+c.WIDTH})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[0]}));this.cubes=s,this.rotationLevel=2}else return n}else if(this.rotationLevel===2){const i=this.cubes.find(s=>s.rotationID===2);if(i&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)-1][Math.floor(i.position.x/c.WIDTH)]){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:o[1]}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{y:o[2].y-c.HEIGHT})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[0]}));this.cubes=s,this.rotationLevel=3}else return n}else if(this.rotationLevel===3){const i=this.cubes.find(s=>s.rotationID===2);if(i&&i.position.x!==0&&!v(n,i,"l")){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:o[1]}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{x:o[2].x-c.WIDTH})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[0]}));this.cubes=s,this.rotationLevel=0}else return n}return n}}),Object.defineProperty(this,"checkContinueDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>o.some(i=>(this.rotationLevel===1&&(i.rotationID===1||i.rotationID===0)||this.rotationLevel===2&&(i.rotationID===0||i.rotationID===1||i.rotationID===3)||this.rotationLevel===3&&(i.rotationID===3||i.rotationID===0)||this.rotationLevel===0&&(i.rotationID===1||i.rotationID===2||i.rotationID===3))&&v(n,i,"d"))});const r={color:ie(t),shape:S.RAISED_BLOCK,position:D.POSITION_1,rotationID:0};this.cubes=[r,Object.assign(Object.assign({},r),{position:D.POSITION_4,rotationID:1}),Object.assign(Object.assign({},r),{position:D.POSITION_5,rotationID:2}),Object.assign(Object.assign({},r),{position:D.POSITION_6,rotationID:3})]}moveLeft(t,r){const n=o=>function(s,a,l){return(o===0&&(a.rotationID===1||a.rotationID===0)||o===1&&(a.rotationID===0||a.rotationID===3||a.rotationID===1)||o===2&&(a.rotationID===3||a.rotationID===0)||o===3&&(a.rotationID===1||a.rotationID===2||a.rotationID===3))&&v(s,a,l)};return this.moveHelper(this,t,r,"x","l",n(this.rotationLevel),U,q)}}class fr extends X{constructor(t){super(),Object.defineProperty(this,"rotationLevel",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"moveLeft",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>{const i=s=>function(l,u,h){return(s===0&&(u.rotationID===2||u.rotationID===0)||s===1&&(u.rotationID===0||u.rotationID===3||u.rotationID===1)||s===2&&(u.rotationID===3||u.rotationID===1)||s===3&&(u.rotationID===0||u.rotationID===2||u.rotationID===3))&&v(l,u,h)};return this.moveHelper(this,n,o,"x","l",i(this.rotationLevel),U,q)}}),Object.defineProperty(this,"moveRight",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>{const i=s=>function(l,u,h){return(s===0&&(u.rotationID===3||u.rotationID===1)||s===2&&(u.rotationID===2||u.rotationID===0)||s===3&&(u.rotationID===0||u.rotationID===1||u.rotationID===3)||s===1&&(u.rotationID===0||u.rotationID===2||u.rotationID===3))&&v(l,u,h)};return this.moveHelper(this,n,o,"x","r",i(this.rotationLevel),F,Y)}}),Object.defineProperty(this,"moveDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>T(this.cubes,"y",o)?this.checkContinueDown(n,this.cubes)?Q(this,n):J(this,n,o):n}),Object.defineProperty(this,"rotate",{enumerable:!0,configurable:!0,writable:!0,value:n=>{const o=this.cubes.reduce((i,s)=>Object.assign(Object.assign({},i),{[s.rotationID]:s.position}),{});if(this.rotationLevel===0){const i=this.cubes.find(s=>s.rotationID===2);if(i&&!v(n,i,"l")&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)+1][Math.floor(i.position.x/c.WIDTH)-1]){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:{x:o[2].x-c.WIDTH,y:o[2].y+c.HEIGHT}}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{x:o[2].x-c.WIDTH})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[1]}));this.cubes=s,this.rotationLevel=1}else return n}else if(this.rotationLevel===1){const i=this.cubes.find(s=>s.rotationID===2);if(i&&i.position.x!==m.CANVAS_WIDTH-c.WIDTH&&!v(n,i,"d")&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)+1][Math.floor(i.position.x/c.WIDTH)+1]){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:{x:o[2].x+c.WIDTH,y:o[2].y+c.HEIGHT}}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{y:o[2].y+c.HEIGHT})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[1]}));this.cubes=s,this.rotationLevel=2}else return n}else if(this.rotationLevel===2){const i=this.cubes.find(s=>s.rotationID===2);if(i&&!v(n,i,"r")&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)-1][Math.floor(i.position.x/c.WIDTH)+1]){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:{x:o[2].x+c.WIDTH,y:o[2].y-c.HEIGHT}}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{x:o[2].x+c.WIDTH})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[1]}));this.cubes=s,this.rotationLevel=3}else return n}else if(this.rotationLevel===3){const i=this.cubes.find(s=>s.rotationID===2);if(i&&i.position.x!==0&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)-1][Math.floor(i.position.x/c.WIDTH)]&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)-1][Math.floor(i.position.x/c.WIDTH)-1]){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:{x:o[2].x-c.WIDTH,y:o[2].y-c.HEIGHT}}):a.rotationID===1?Object.assign(Object.assign({},a),{position:Object.assign(Object.assign({},o[2]),{y:o[2].y-c.HEIGHT})}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:o[1]}));this.cubes=s,this.rotationLevel=0}else return n}return n}}),Object.defineProperty(this,"checkContinueDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>o.some(i=>(this.rotationLevel===1&&(i.rotationID===2||i.rotationID===0)||this.rotationLevel===2&&(i.rotationID===0||i.rotationID===1||i.rotationID===3)||this.rotationLevel===3&&(i.rotationID===3||i.rotationID===1)||this.rotationLevel===0&&(i.rotationID===0||i.rotationID===2||i.rotationID===3))&&v(n,i,"d"))});const r={color:ie(t),shape:S.LIGHTNING_BLOCK,position:D.POSITION_1,rotationID:0};this.cubes=[r,Object.assign(Object.assign({},r),{position:D.POSITION_2,rotationID:1}),Object.assign(Object.assign({},r),{position:D.POSITION_6,rotationID:2}),Object.assign(Object.assign({},r),{position:D.POSITION_7,rotationID:3})]}}class hr extends X{constructor(t){super(),Object.defineProperty(this,"rotationLevel",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"moveLeft",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>{const i=s=>function(l,u,h){return(s===0&&u.rotationID===0||s===1&&(u.rotationID===0||u.rotationID===1||u.rotationID===2||u.rotationID===3))&&v(l,u,h)};return this.moveHelper(this,n,o,"x","l",i(this.rotationLevel),U,q)}}),Object.defineProperty(this,"moveRight",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>{const i=s=>function(l,u,h){return(s===0&&u.rotationID===3||s===1&&(u.rotationID===0||u.rotationID===1||u.rotationID===2||u.rotationID===3))&&v(l,u,h)};return this.moveHelper(this,n,o,"x","r",i(this.rotationLevel),F,Y)}}),Object.defineProperty(this,"moveDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>T(this.cubes,"y",o)?this.checkContinueDown(n,this.cubes)?Q(this,n):J(this,n,o):n}),Object.defineProperty(this,"rotate",{enumerable:!0,configurable:!0,writable:!0,value:n=>{const o=this.cubes.reduce((i,s)=>Object.assign(Object.assign({},i),{[s.rotationID]:s.position}),{});if(this.rotationLevel===0){const i=this.cubes.find(s=>s.rotationID===2);if(i&&i.position.y<m.CANVAS_HEIGHT-c.HEIGHT&&i.position.y>=2*c.HEIGHT&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)-1][Math.floor(i.position.x/c.WIDTH)]&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)-2][Math.floor(i.position.x/c.WIDTH)]&&!v(n,i,"d")){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:{x:o[2].x,y:o[2].y-2*c.HEIGHT}}):a.rotationID===1?Object.assign(Object.assign({},a),{position:{x:o[2].x,y:o[2].y-c.HEIGHT}}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:{x:o[2].x,y:o[2].y+c.HEIGHT}}));this.cubes=s,this.rotationLevel=1}else return n}else if(this.rotationLevel===1){const i=this.cubes.find(s=>s.rotationID===2);if(i&&i.position.x>=2*c.WIDTH&&i.position.x<m.CANVAS_WIDTH-c.WIDTH&&!n.oldGameCubes[Math.floor(i.position.y/c.HEIGHT)][Math.floor(i.position.x/c.WIDTH)-2]&&!v(n,i,"l")&&!v(n,i,"r")){const s=this.cubes.map(a=>a.rotationID===0?Object.assign(Object.assign({},a),{position:{x:o[2].x-2*c.WIDTH,y:o[2].y}}):a.rotationID===1?Object.assign(Object.assign({},a),{position:{x:o[2].x-c.WIDTH,y:o[2].y}}):a.rotationID===2?a:Object.assign(Object.assign({},a),{position:{x:o[2].x+c.WIDTH,y:o[2].y}}));this.cubes=s,this.rotationLevel=0}else return n}return n}}),Object.defineProperty(this,"checkContinueDown",{enumerable:!0,configurable:!0,writable:!0,value:(n,o)=>o.some(i=>(this.rotationLevel===1&&i.rotationID===3||this.rotationLevel===0&&(i.rotationID===0||i.rotationID===1||i.rotationID===2||i.rotationID===3))&&v(n,i,"d"))});const r={color:ie(t),shape:S.LINE_BLOCK,position:D.POSITION_0,rotationID:0};this.cubes=[r,Object.assign(Object.assign({},r),{position:D.POSITION_1,rotationID:1}),Object.assign(Object.assign({},r),{position:D.POSITION_2,rotationID:2}),Object.assign(Object.assign({},r),{position:D.POSITION_3,rotationID:3})]}}class st extends X{constructor(t,r){super(),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"shape",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"moveLeft",{enumerable:!0,configurable:!0,writable:!0,value:(o,i)=>T(this.cubes,"x",i)?this.cubes.some(s=>v(o,s,"l"))?U(this,o):q(this,o,i):o}),Object.defineProperty(this,"moveRight",{enumerable:!0,configurable:!0,writable:!0,value:(o,i)=>T(this.cubes,"x",i)?this.cubes.some(s=>v(o,s,"r"))?F(this,o):Y(this,o,i):o}),Object.defineProperty(this,"moveDown",{enumerable:!0,configurable:!0,writable:!0,value:(o,i)=>T(this.cubes,"y",i)?this.checkContinueDown(o,this.cubes)?Q(this,o):J(this,o,i):o}),Object.defineProperty(this,"rotate",{enumerable:!0,configurable:!0,writable:!0,value:o=>o}),Object.defineProperty(this,"checkContinueDown",{enumerable:!0,configurable:!0,writable:!0,value:(o,i)=>i.some(s=>v(o,s,"d"))});const n={color:t,shape:r,position:D.POSITION_1,rotationID:0};this.cubes=[n]}}class dr extends st{constructor(){super("white",S.STAR)}}class pr extends st{constructor(){super("rgba(74, 64, 53, 0.7)",S.BOMB),Object.defineProperty(this,"updateOldGameCubes",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const r=this.cubes[0],o=this.getAdjacentPositions(r.position).reduce((i,s)=>it(i,Math.floor(s.y/c.HEIGHT),Math.floor(s.x/c.WIDTH),null),t.oldGameCubes);return Object.assign(Object.assign({},t),{oldGameCubes:o})}}),Object.defineProperty(this,"getAdjacentPositions",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const{x:r,y:n}=t;return[{x:r,y:n-c.HEIGHT},{x:r,y:n+c.HEIGHT},{x:r-c.WIDTH,y:n},{x:r+c.WIDTH,y:n},{x:r,y:n}]}})}}const Pe=(e,t=null)=>{if(e.oldGameCubes[0].some(n=>n!==null))return Object.assign(Object.assign({},e),{gameEnd:!0});if(!e.currentGameCube||e.needToCreateCube){const{currentBlock:n,nextBlock:o}=Ge(e,e.shapeSeed,e.colorSeed);return Object.assign(Object.assign({},e),{currentGameCube:e.nextBlock||n,nextBlock:o,needToCreateCube:!1})}const r=n=>ar(n.oldGameCubes)?ur(n):n;if(e.currentGameCube.checkContinueMove(e))if(t!==null){if(t.axis==="x"&&t.amount<0){const n=e.currentGameCube.moveLeft(e,t.amount);return r(n)}else if(t.axis==="x"&&t.amount>0){const n=e.currentGameCube.moveRight(e,t.amount);return r(n)}else if(t.axis==="y"&&t.amount>0){const n=e.currentGameCube.moveDown(e,t.amount);return r(n)}else if(t.axis==="z"){const n=e.currentGameCube.rotate(e);return r(n)}}else{const n=e.currentGameCube.updatePositions(e);return r(n)}else{const n=e.currentGameCube.updateOldGameCubes(e),{currentBlock:o,nextBlock:i}=Ge(e,e.shapeSeed,e.colorSeed);return n.oldGameCubes[0].some(s=>s!==null)?Object.assign(Object.assign({},ge(n)),{gameEnd:!0}):Object.assign(Object.assign({},ge(n)),{currentGameCube:e.nextBlock||o,nextBlock:i})}return e},m={CANVAS_WIDTH:200,CANVAS_HEIGHT:400,PREVIEW_WIDTH:160,PREVIEW_HEIGHT:80},C={TICK_RATE_MS:500,GRID_WIDTH:10,GRID_HEIGHT:20,CUBE_NUMBERS:4},c={WIDTH:m.CANVAS_WIDTH/C.GRID_WIDTH,HEIGHT:m.CANVAS_HEIGHT/C.GRID_HEIGHT},S={SQUARE_BLOCK:0,RAISED_BLOCK:1,LIGHTNING_BLOCK:2,LINE_BLOCK:3,BEDROCK:4,STAR:5,BOMB:6},D={POSITION_0:{x:c.WIDTH*(Math.floor(m.CANVAS_WIDTH/c.WIDTH/2)-2),y:0},POSITION_1:{x:c.WIDTH*(Math.floor(m.CANVAS_WIDTH/c.WIDTH/2)-1),y:0},POSITION_2:{x:c.WIDTH*Math.floor(m.CANVAS_WIDTH/c.WIDTH/2),y:0},POSITION_3:{x:c.WIDTH*(Math.floor(m.CANVAS_WIDTH/c.WIDTH/2)+1),y:0},POSITION_4:{x:c.WIDTH*(Math.floor(m.CANVAS_WIDTH/c.WIDTH/2)-2),y:c.HEIGHT},POSITION_5:{x:c.WIDTH*(Math.floor(m.CANVAS_WIDTH/c.WIDTH/2)-1),y:c.HEIGHT},POSITION_6:{x:c.WIDTH*Math.floor(m.CANVAS_WIDTH/c.WIDTH/2),y:c.HEIGHT},POSITION_7:{x:c.WIDTH*(Math.floor(m.CANVAS_WIDTH/c.WIDTH/2)+1),y:c.HEIGHT}},R={gameEnd:!1,needToCreateCube:!0,scoreAndDropRate:{gameLevel:1,gameScore:0,gameHighScore:0,dropRate:1},oldGameCubes:new Array(C.GRID_HEIGHT).fill(null).map(()=>new Array(C.GRID_WIDTH).fill(null)),shapeSeed:0,colorSeed:0},_e=e=>{e.setAttribute("visibility","visible"),e.parentNode.appendChild(e)},Re=e=>e.setAttribute("visibility","hidden"),Le=(e,t,r={})=>{const n=document.createElementNS(e,t);return Object.entries(r).forEach(([o,i])=>n.setAttribute(o,i)),n};function br(){const e=document.querySelector("#svgCanvas"),t=document.querySelector("#svgPreview"),r=document.querySelector("#gameOver"),n=document.querySelector("#gameRestart");document.querySelector("#main");const o=document.querySelector("#instantReplay");e.setAttribute("height",`${m.CANVAS_HEIGHT}`),e.setAttribute("width",`${m.CANVAS_WIDTH}`),t.setAttribute("height",`${m.PREVIEW_HEIGHT}`),t.setAttribute("width",`${m.PREVIEW_WIDTH}`);const i=document.querySelector("#levelText"),s=document.querySelector("#scoreText"),a=document.querySelector("#highScoreText"),l=$(document,"keypress"),u=$(document,"click").pipe(A(()=>({type:"mouseClick"}))),h=$(o,"click").pipe(A(()=>({type:"instantReplay"}))),y=(f,p)=>l.pipe(or(({code:x})=>x===f),A(()=>p)),d=y("KeyA",{axis:"x",amount:-c.WIDTH}),O=y("KeyD",{axis:"x",amount:c.WIDTH}),w=y("KeyS",{axis:"y",amount:c.HEIGHT}),I=y("KeyW",{axis:"z",amount:0}),Z=Ee(be(199))(3).pipe(A(f=>({shapeSeed:f}))),P=Ee(be(31))(7).pipe(A(f=>({colorSeed:f}))),M=be(C.TICK_RATE_MS),we=f=>{if(f){const p=Le(e.namespaceURI,"rect",{height:`${c.HEIGHT}`,width:`${c.WIDTH}`,x:`${f.position.x}`,y:`${f.position.y}`,style:`fill: ${f.color}`,class:"gameBlock"});e.appendChild(p)}},at=f=>{if(f){const p=Le(t.namespaceURI,"rect",{height:`${c.HEIGHT}`,width:`${c.WIDTH}`,x:`${f.position.x-c.WIDTH}`,y:`${f.position.y+c.HEIGHT}`,style:`fill: ${f.color}`,class:"preGameBlock"});t.appendChild(p)}},ut=f=>{var p,x,_;f.scoreAndDropRate&&(i.textContent=((p=f.scoreAndDropRate.gameLevel)===null||p===void 0?void 0:p.toString())||"0",s.textContent=((x=f.scoreAndDropRate.gameScore)===null||x===void 0?void 0:x.toString())||"0",a.textContent=((_=f.scoreAndDropRate.gameHighScore)===null||_===void 0?void 0:_.toString())||"0"),e.querySelectorAll(".gameBlock").forEach(H=>e.removeChild(H)),t.querySelectorAll(".preGameBlock").forEach(H=>t.removeChild(H)),f.nextBlock&&f.nextBlock.cubes.forEach(H=>at(H)),f.currentGameCube&&f.currentGameCube.cubes.forEach(H=>we(H)),f.oldGameCubes&&f.oldGameCubes.map(H=>H.map(we))};nr(M,d,O,w,I,u,h,Z,P).pipe(ot((f,p)=>{var x,_,z,ee,H,se,ae,ue,ce,le,fe,he;return typeof p=="number"?Pe(f):p&&"shapeSeed"in p&&p.shapeSeed?Object.assign(Object.assign({},f),{shapeSeed:p.shapeSeed}):p&&"colorSeed"in p&&p.colorSeed?Object.assign(Object.assign({},f),{colorSeed:p.colorSeed}):p&&"type"in p&&p.type==="mouseClick"?f.gameEnd?Object.assign(Object.assign({},R),{scoreAndDropRate:Object.assign(Object.assign({},R.scoreAndDropRate),{gameHighScore:((x=f.scoreAndDropRate)===null||x===void 0?void 0:x.gameScore)>((_=R.scoreAndDropRate)===null||_===void 0?void 0:_.gameHighScore)&&((z=f.scoreAndDropRate)===null||z===void 0?void 0:z.gameScore)>((ee=f.scoreAndDropRate)===null||ee===void 0?void 0:ee.gameHighScore)?(H=f.scoreAndDropRate)===null||H===void 0?void 0:H.gameScore:(se=f.scoreAndDropRate)===null||se===void 0?void 0:se.gameHighScore})}):f:p&&"type"in p&&p.type==="instantReplay"?Object.assign(Object.assign({},R),{scoreAndDropRate:Object.assign(Object.assign({},R.scoreAndDropRate),{gameHighScore:((ae=f.scoreAndDropRate)===null||ae===void 0?void 0:ae.gameScore)>((ue=R.scoreAndDropRate)===null||ue===void 0?void 0:ue.gameHighScore)&&((ce=f.scoreAndDropRate)===null||ce===void 0?void 0:ce.gameScore)>((le=f.scoreAndDropRate)===null||le===void 0?void 0:le.gameHighScore)?(fe=f.scoreAndDropRate)===null||fe===void 0?void 0:fe.gameScore:(he=f.scoreAndDropRate)===null||he===void 0?void 0:he.gameHighScore})}):Pe(f,p)},R)).subscribe(f=>{ut(f),f.gameEnd?(_e(r),_e(n)):(Re(r),Re(n))})}typeof window<"u"&&(window.onload=()=>{br()});
